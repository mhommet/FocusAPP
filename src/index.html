<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FOCUS</title>
    <link rel="stylesheet" href="styles/style.css">
    <link rel="icon" type="image/png" href="assets/logo.ico">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body>
    <div class="container">
        <header>
            <div class="header-title">
                <h1>FOCUS <span id="version" class="version-badge">Loading...</span></h1>
            </div>
            <!-- Global Champion Search -->
            <div class="global-search-container">
                <div class="global-search-wrapper">
                    <i class="fas fa-search global-search-icon"></i>
                    <input type="text" id="global-search" placeholder="Champion or Player#TAG..." autocomplete="off" spellcheck="false">
                    <div id="global-search-results" class="global-search-dropdown"></div>
                </div>
            </div>
            <button id="refresh-btn" class="btn-refresh">
                <i class="fas fa-sync-alt"></i> Actualiser
            </button>
        </header>

        <!-- Navigation Tabs -->
        <nav class="tabs-nav">
            <!-- ✅ Plus de onclick, utilise data-tab -->
            <button class="tab-btn active" data-tab="tierlist">
                <i class="fas fa-trophy"></i> Tier List
            </button>
            <button class="tab-btn" data-tab="builds">
                <i class="fas fa-hammer"></i> Builds
            </button>
            <button class="tab-btn" data-tab="items">
                <i class="fas fa-gem"></i> Items
            </button>
            <button class="tab-btn" data-tab="changelog">
                <i class="fas fa-scroll"></i> Changelog
            </button>
        </nav>

        <!-- Backend Status Banner -->
        <div id="backend-status" class="backend-status-banner" style="display: none;">
            <i class="fas fa-exclamation-triangle"></i>
            <span>Backend API is not running.</span>
            <!-- ✅ Plus de onclick -->
            <button class="retry-btn-small">
                <i class="fas fa-redo"></i> Retry
            </button>
        </div>

        <!-- TIER LIST TAB -->
        <div id="tierlist-tab" class="tab-content active">
            <div class="controls-bar">
                <div class="control-group role-filter-group">
                    <div class="role-filter-inline">
                        <!-- ✅ Plus de onclick, utilise data-role -->
                        <button class="role-filter-btn-small active" data-role="all" title="Tous les roles">
                            <i class="fas fa-asterisk"></i>
                        </button>
                        <button class="role-filter-btn-small" data-role="top" title="Top">
                            <img src="https://raw.communitydragon.org/latest/plugins/rcp-fe-lol-clash/global/default/assets/images/position-selector/positions/icon-position-top.png"
                                alt="Top" class="role-icon-small">
                        </button>
                        <button class="role-filter-btn-small" data-role="jungle" title="Jungle">
                            <img src="https://raw.communitydragon.org/latest/plugins/rcp-fe-lol-clash/global/default/assets/images/position-selector/positions/icon-position-jungle.png"
                                alt="Jungle" class="role-icon-small">
                        </button>
                        <button class="role-filter-btn-small" data-role="mid" title="Mid">
                            <img src="https://raw.communitydragon.org/latest/plugins/rcp-fe-lol-clash/global/default/assets/images/position-selector/positions/icon-position-middle.png"
                                alt="Mid" class="role-icon-small">
                        </button>
                        <button class="role-filter-btn-small" data-role="bottom" title="ADC">
                            <img src="https://raw.communitydragon.org/latest/plugins/rcp-fe-lol-clash/global/default/assets/images/position-selector/positions/icon-position-bottom.png"
                                alt="ADC" class="role-icon-small">
                        </button>
                        <button class="role-filter-btn-small" data-role="support" title="Support">
                            <img src="https://raw.communitydragon.org/latest/plugins/rcp-fe-lol-clash/global/default/assets/images/position-selector/positions/icon-position-utility.png"
                                alt="Support" class="role-icon-small">
                        </button>
                    </div>
                </div>

                <div class="control-separator"></div>
                <div class="control-group">
                    <span id="tierlist-last-update" class="last-update-badge"></span>
                </div>

                <div class="control-group search-group">
                    <label for="search-input"><i class="fas fa-search"></i> Recherche</label>
                    <!-- ✅ Plus de onkeyup -->
                    <input type="text" id="search-input" placeholder="Chercher un champion...">
                </div>

                <div class="control-group hint-group">
                    <span class="click-hint"><i class="fas fa-mouse-pointer"></i> Cliquez sur un champion pour voir son build</span>
                </div>
            </div>

            <main>
                <div class="card">
                    <table id="tier-list-table">
                        <thead>
                            <tr>
                                <!-- ✅ Plus de onclick, utilise data-sort -->
                                <th data-sort="rank" title="Trier par rang"># <i class="fas fa-sort"></i></th>
                                <th data-sort="name" title="Trier par nom">Champion <i class="fas fa-sort"></i></th>
                                <th data-sort="role" title="Trier par role">Roles <i class="fas fa-sort"></i></th>
                                <th data-sort="tier" title="Trier par tier">Tier <i class="fas fa-sort"></i></th>
                                <th data-sort="winrate" title="Trier par winrate">Winrate <i class="fas fa-sort"></i>
                                </th>
                                <th data-sort="pickrate" title="Trier par pickrate">Pickrate <i class="fas fa-sort"></i>
                                </th>
                                <th data-sort="games" title="Trier par games">Games <i class="fas fa-sort"></i></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td colspan="7" class="loading-cell">En attente des donnees...</td>
                            </tr>
                        </tbody>
                    </table>
                    <div id="pagination" class="pagination"></div>
                </div>
            </main>
        </div>

        <!-- BUILDS TAB -->
        <div id="builds-tab" class="tab-content">
            <div class="controls-bar">
                <div class="control-group champion-search-control">
                    <label for="champion-search"><i class="fas fa-user"></i> Champion</label>
                    <div class="champion-search-container">
                        <div class="search-input-wrapper">
                            <input type="text" id="champion-search" placeholder="Recherche champion..." class="search-input" autocomplete="off" spellcheck="false">
                            <button id="champion-search-clear" class="search-clear-btn" type="button" title="Effacer">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div id="champion-grid" class="champion-grid"></div>
                    </div>
                </div>

                <div class="control-separator"></div>

                <div class="control-group">
                    <label for="role-select"><i class="fas fa-map"></i> Role</label>
                    <select id="role-select">
                        <option value="top">Top</option>
                        <option value="jungle">Jungle</option>
                        <option value="mid">Mid</option>
                        <option value="adc">ADC</option>
                        <option value="support">Support</option>
                    </select>
                </div>

                <div class="control-separator"></div>

                <div class="control-group">
                    <!-- ✅ Plus de onclick -->
                    <button id="build-refresh-btn" class="btn-refresh-small" title="Force refresh data">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                </div>

                <div class="control-group">
                    <span id="build-cache-info" class="cache-info-badge"></span>
                </div>

                <div class="control-group">
                    <span id="build-quality-indicator" class="quality-indicator"></span>
                </div>
            </div>

            <main>
                <div id="build-container" class="build-container">
                    <div class="build-placeholder">
                        <i class="fas fa-hammer"></i>
                        <p>Selectionnez un champion pour voir son build</p>
                    </div>
                </div>
            </main>
        </div>

        <!-- PLAYER PROFILE TAB (Hidden from nav, accessed via search) -->
        <div id="player-tab" class="tab-content">
            <!-- Loading State -->
            <div id="player-loading" class="player-page-loading">
                <div class="spinner-ring large"></div>
                <p>Loading player profile...</p>
            </div>

            <!-- Error State -->
            <div id="player-error" class="player-page-error" style="display: none;">
                <i class="fas fa-user-slash"></i>
                <h2>Player Not Found</h2>
                <p id="player-error-message">The summoner could not be found.</p>
                <button class="btn btn-primary" onclick="retryPlayerSearch()">
                    <i class="fas fa-redo"></i> Retry
                </button>
                <button class="btn btn-secondary" onclick="switchTab('tierlist')">
                    <i class="fas fa-arrow-left"></i> Back to Tier List
                </button>
            </div>

            <!-- Player Profile Content -->
            <div id="player-content" class="player-page-content" style="display: none;">
                <!-- Header Section -->
                <div class="player-page-header">
                    <button class="player-back-btn" onclick="switchTab('tierlist')">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <div class="player-identity">
                        <img id="player-page-avatar" class="player-page-avatar" src="" alt="Avatar">
                        <div class="player-page-info">
                            <h1 id="player-page-name">Player#TAG</h1>
                    
                            <!-- ✅ AJOUT DES TAGS ICI -->
                            <div id="player-tags" class="player-tags" style="display: flex; gap: 8px; margin: 5px 0; flex-wrap: wrap;">
                            </div>
                    
                            <span id="player-page-level" class="player-level">Level 0</span>
                        </div>
                    </div>
                    <button id="profile-update-btn" class="btn btn-refresh-small" onclick="refreshPlayerProfile()">
                        <i class="fas fa-sync-alt"></i> Update
                    </button>
                </div>

                <!-- Main Grid Layout -->
                <div class="player-page-grid">
                    <!-- Sidebar (Left) -->
                    <aside class="player-sidebar">
                        <!-- Ranked Card -->
                        <div class="player-ranked-card">
                            <h3><i class="fas fa-trophy"></i> Ranked Solo/Duo</h3>
                            <div class="ranked-info">
                                <div class="rank-emblem-container">
                                    <img id="player-rank-icon" class="rank-emblem" src="" alt="Rank">
                                </div>
                                <div class="ranked-details">
                                    <span id="player-page-rank" class="rank-tier">Unranked</span>
                                    <span id="player-page-lp" class="rank-lp">0 LP</span>
                                    <span id="player-page-ranked-wr" class="rank-winrate">0% WR</span>
                                </div>
                            </div>
                        </div>

                        <!-- Top Champions -->
                        <div class="player-top-champs-card">
                            <h3><i class="fas fa-star"></i> Top Champions</h3>
                            <div id="player-top-champs" class="top-champs-list">
                                <p class="no-data">No data available</p>
                            </div>
                        </div>

                        <!-- Recent Stats -->
                        <div class="player-stats-card">
                            <h3><i class="fas fa-chart-line"></i> Recent Performance</h3>
                            <div class="stats-grid">
                                <div class="stat-item">
                                    <span class="stat-value" id="player-recent-wr">0%</span>
                                    <span class="stat-label">Win Rate</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-value" id="player-recent-kda">0.0</span>
                                    <span class="stat-label">KDA</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-value" id="player-recent-games">0</span>
                                    <span class="stat-label">Games</span>
                                </div>
                            </div>
                        </div>
                    </aside>

                    <!-- Match History (Right) -->
                    <section class="player-matches-section">
                        <div class="matches-header">
                            <h2><i class="fas fa-history"></i> Match History</h2>
                            <span id="player-matches-count" class="matches-count">0 matches</span>
                        </div>
                        <div id="player-matches-list" class="player-matches-list-full">
                            <!-- Match cards will be rendered here -->
                        </div>
                    </section>
                </div>
            </div>
        </div>

        <!-- ITEMS TAB -->
        <div id="items-tab" class="tab-content">
            <div class="controls-bar items-controls-bar">
                <div class="search-group-inline">
                    <i class="fas fa-search"></i>
                    <!-- ✅ Plus de onkeyup -->
                    <input type="text" id="item-search" placeholder="Search items..." class="search-input-inline">
                </div>

                <div class="control-separator"></div>

                <div class="filter-group-inline">
                    <label for="item-stat"><i class="fas fa-filter"></i> Stat:</label>
                    <!-- ✅ Plus de onchange -->
                    <select id="item-stat" class="filter-select-inline">
                        <option value="all">All Stats</option>
                        <option value="ad">Attack Damage</option>
                        <option value="ap">Ability Power</option>
                        <option value="health">Health</option>
                        <option value="armor">Armor</option>
                        <option value="mr">Magic Resist</option>
                        <option value="as">Attack Speed</option>
                        <option value="crit">Critical Strike</option>
                    </select>
                </div>

                <div class="control-separator"></div>

                <div class="filter-group-inline">
                    <label for="item-category"><i class="fas fa-layer-group"></i> Type:</label>
                    <select id="item-category" class="filter-select-inline">
                        <option value="all">All</option>
                        <option value="legendary">Legendary</option>
                        <option value="epic">Epic</option>
                        <option value="basic">Basic</option>
                    </select>
                </div>

                <div class="control-separator"></div>

                <div class="filter-group-inline">
                    <label for="item-price"><i class="fas fa-coins"></i> Price:</label>
                    <select id="item-price" class="filter-select-inline">
                        <option value="all">All</option>
                        <option value="0-1000">&lt; 1000g</option>
                        <option value="1000-2000">1-2k</option>
                        <option value="2000-3000">2-3k</option>
                        <option value="3000+">3k+</option>
                    </select>
                </div>

                <div class="control-separator"></div>

                <div class="filter-group-inline">
                    <label for="item-efficiency"><i class="fas fa-percent"></i> Eff:</label>
                    <select id="item-efficiency" class="filter-select-inline">
                        <option value="all">All</option>
                        <option value="high">&ge;100%</option>
                        <option value="medium">90-99%</option>
                        <option value="low">&lt;90%</option>
                    </select>
                </div>

                <div class="control-separator"></div>

                <span id="items-patch-version" class="version-badge">Patch ...</span>
            </div>

            <main>
                <div class="card">
                    <div id="items-grid" class="items-grid">
                        <div class="loading-cell">En attente des donnees...</div>
                    </div>
                    <div id="items-pagination" class="pagination"></div>
                </div>
            </main>
        </div>

        <!-- CHANGELOG TAB -->
        <div id="changelog-tab" class="tab-content">
            <div class="changelog-header">
                <h2><i class="fas fa-scroll"></i> What's New</h2>
                <button id="refresh-changelog" class="btn-refresh-small">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
            </div>
            <div class="card changelog-card">
                <div id="changelog-list" class="changelog-list">
                    <div class="changelog-loading">
                        <div class="spinner-ring"></div>
                        <span>Loading changelog...</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Player Profile Modal -->
    <div id="player-modal" class="player-modal-overlay" style="display: none;">
        <div class="player-modal">
            <button class="player-modal-close" onclick="closePlayerModal()">
                <i class="fas fa-times"></i>
            </button>

            <!-- Player Header -->
            <div class="player-modal-header">
                <img id="player-avatar" class="player-avatar" src="" alt="Avatar">
                <div class="player-info">
                    <h2 id="player-name" class="player-name">Loading...</h2>
                    <div id="player-tags" class="player-tags" style="display: flex; gap: 8px; margin-top: 10px; flex-wrap: wrap;"></div>
                    <div class="player-rank-container">
                        <span id="player-rank" class="player-rank-badge">Unranked</span>
                        <span id="player-winrate" class="player-winrate">0% WR (0W/0L)</span>
                    </div>
                </div>
            </div>

            <!-- Match History -->
            <div class="player-modal-body">
                <h3><i class="fas fa-history"></i> Recent Matches</h3>
                <div id="player-matches" class="player-matches-list">
                    <div class="player-matches-loading">
                        <div class="spinner-ring"></div>
                        <span>Loading matches...</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- CS Overlay Service (charge avant main.js) -->
    <script src="services/csOverlayService.js"></script>
    <!-- Gameflow Controller - LCU-based automation (Vanguard-safe) -->
    <script src="services/gameflowController.js"></script>
    <!-- ✅ Script EN DERNIER -->
    <script type="module" src="scripts/main.js"></script>
</body>

</html>